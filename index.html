<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>KidVision Student Observations</title>
<link rel="manifest" href="manifest.webmanifest">
<link rel="stylesheet" href="styles.css">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="KidVision">
<link rel="apple-touch-icon" href="icon-192.png">
</head>
<body>
<div id="gateOverlay">
  <div id="gateCard">
    <h2>Teacher Access</h2>
    <p>Enter your <b>email</b> and <b>invite code</b> to continue.</p>
    <div id="gateErr"></div>
    <input id="gateEmail" placeholder="Email">
    <input id="gateCode" placeholder="Invite code">
    <button id="gateSubmit">Continue</button>
    <small id="gateDbg"></small>
    <a id="ownerLink" href="owner_login.html">Owner login</a>
  </div>
</div>

<div class="app">
  <header>
    <div class="row">
      <span class="brand">KidVision Student Observations</span>
      <span class="badge">Local & Offline</span>
    </div>
    <div class="tabs" id="tabs">
      <button class="tab active" data-tab="quick">Quick Rate</button>
      <button class="tab" data-tab="records">Records</button>
      <button class="tab" data-tab="student">Student View</button>
      <button class="tab" data-tab="settings">Settings</button>
      <button class="tab" data-tab="admin" id="adminTab" style="display:none">Admin</button>
    </div>
  </header>

  <section id="quick" class="section active card">
    <h3>Quick Rate</h3>
    <div class="row">
      <select id="studentSelect" style="flex:1"></select>
      <select id="subjectSelect" style="flex:1"></select>
    </div>
    <div class="row" style="margin-top:8px">
      <input id="standardSearch" placeholder="Search standard (code or text)…" style="flex:1">
      <select id="standardSelect" style="flex:1"></select>
    </div>
    <div class="row" style="margin-top:8px">
      <select id="subskillSelect" style="flex:1" disabled><option value="">Select subskill…</option></select>
      <div id="ratingGroup" class="row">
        <button data-v="1">1</button><button data-v="2">2</button><button data-v="3">3</button><button data-v="4">4</button><button data-v="5">5</button>
      </div>
      <input id="dateInput" type="date" class="right">
    </div>
    <textarea id="notes" placeholder="Notes / evidence / accommodations…"></textarea>
    <div class="row" style="margin-top:8px">
      <button id="saveBtn">Save</button>
      <small class="muted">5 = Proficient · 1 = Not proficient</small>
    </div>
  </section>

  <section id="records" class="section card">
    <h3>Records</h3>
    <div class="row" style="margin:8px 0">
      <input id="filterStudent" placeholder="Filter by student…" style="flex:1">
      <input id="filterCode" placeholder="Filter by code/text/subskill…" style="flex:1">
      <select id="filterSubject"></select>
      <select id="filterRating"><option value="">All</option><option>5</option><option>4</option><option>3</option><option>2</option><option>1</option></select>
      <button id="exportBtn" class="right">Export CSV</button>
    </div>
    <div style="max-height:420px;overflow:auto">
      <table id="dataTable">
        <thead><tr><th>Date</th><th>Student</th><th>Subject</th><th>Code</th><th>Standard</th><th>Subskill</th><th>Rating</th><th>Notes</th><th>Action</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <section id="student" class="section card">
    <h3>Student View</h3>
    <div class="row" style="margin-bottom:8px">
      <select id="studentViewSelect" style="flex:1"></select>
      <button id="studentExport">Export this student</button>
    </div>
    <div style="max-height:420px;overflow:auto">
      <table id="studentTable">
        <thead><tr><th>Date</th><th>Subject</th><th>Code</th><th>Standard</th><th>Subskill</th><th>Rating</th><th>Notes</th><th>Action</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <section id="settings" class="section card">
    <h3>Settings</h3>
    <div class="toggle"><input type="checkbox" id="hideNames"><label for="hideNames"> Hide student names in app</label></div>
    <div class="toggle" style="margin-top:8px"><input type="checkbox" id="useInitials"><label for="useInitials"> Show initials when names are hidden</label></div>

    <div class="row" style="margin-top:12px">
      <input id="newStudentName" placeholder="Add student name" style="flex:1">
      <button id="addStudentBtn">Add</button>
      <button id="clearStudentsBtn" style="background:#2a0e12;border-color:#5e1921" class="right">Clear students</button>
    </div>
    <div class="row" style="margin-top:8px">
      <input type="file" id="studentCSV" accept=".csv">
      <button id="importStudentsBtn">Import CSV</button>
      <button id="downloadTemplateBtn" class="right">Download template</button>
    </div>
    <small class="note" id="studentCount"></small>

    <hr class="split" id="accessSplit" style="display:none">
    <div id="accessBlock" style="display:none">
      <h3>Access control (Supabase)</h3>
      <div class="row">
        <input id="sbUrl" placeholder="Supabase URL" style="flex:1">
        <input id="sbKey" placeholder="Supabase anon public key" type="password" style="flex:1">
        <button id="saveSb">Save</button>
      </div>
      <small class="note">Defaults are baked in; only change if you switch projects.</small>
    </div>
  </section>

  <section id="admin" class="section card">
    <h3>Owner Admin</h3>
    <div id="adminLocked" class="row" style="margin-bottom:8px">
      <small class="note">You are in admin mode.</small>
      <button id="adminLogout" style="background:#2a0e12;border-color:#5e1921">Admin logout</button>
    </div>
    <div id="adminPanel">
      <div class="row" style="margin-bottom:8px">
        <button id="refreshCodes">Refresh codes</button>
        <input id="newCode" placeholder="Invite code (e.g., KIDV-25-ABCD-1234)" style="flex:1">
        <input id="newEmail" placeholder="Email (optional)" style="flex:1">
        <button id="addCode">Add</button>
      </div>
      <small class="note">Codes are case-insensitive; spaces + hyphens ignored.</small>
      <div style="max-height:420px;overflow:auto">
        <table id="codesTable">
          <thead><tr><th>Code</th><th>Status</th><th>Bound Email</th><th>Redeemed at</th><th>Actions</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>
</div>

<div class="footer-logo"><img src="kidvision_logo.png" alt="KidVision logo"></div>

<script src="app.js"></script>
</body>
</html>
